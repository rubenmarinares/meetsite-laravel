Documentaci贸n:


Base proyecto: https://www.youtube.com/watch?v=f9FKZE4C3vE

Instalamos Fortify(paquete para la gesti贸n de usuarios)
    https://www.youtube.com/watch?v=5c9iJ3hWpk4

Instalamos Spatie(gesti贸n de roles y permisos)

SPATIE (para permisos y roles) https://www.youtube.com/watch?v=nKtJEezp7WI




CUANDO creamos el modelo tenemos que definier para que se va a utilizar y en la tabla de exportaci贸n
tenemos que a帽adrile los campo que queremos que tengan
php artisan make:model


{{ dd($menuitems) }}
@php dd($menuitems); @endphp



Quiero crear un array de academias en session cuando el usuario se loguee por lo que voy a generar un controller:
php artisan make:controller Auth/AuthenticatedSessionController

Despu茅s implementamos el m茅todo store dentro del controller


Y sobreescribimos la direcci贸n de login de fortify
use App\Http\Controllers\Auth\AuthenticatedSessionController;

Route::post('/login', [AuthenticatedSessionController::class, 'store'])->middleware(['guest'])->name('login');


php artisan db:seed

Generar tabla pivot:
php artisan make:migration create_role_user_table



PREPARAR TRAIT EN LARAVEL PARA REUTILIZAR CDIGO

<?php

namespace App\Traits;

use App\Models\Academia;
use App\Models\Profesor;
use Illuminate\Support\Facades\Auth;

trait PreparaFormularioProfesor
{
    public function prepararFormularioProfesor(array $data = []): array
    {
        $user = Auth::user();

        if ($user->hasRole('super-admin')) {
            $academias = Academia::query()->orderByRaw('academia')->get();
            $menu = true;
        } else {
            $academias = Academia::query()
                ->whereHas('users', function ($query) use ($user) {
                    $query->where('users.id', $user->id);
                })
                ->orderByRaw('academia')->get();
            $menu = false;
        }

        return [
            'profesor' => new Profesor(),
            'submitButtonText' => 'Crear Profesor',
            'actionUrl' => route('profesores.store'),
            'method' => 'POST',
            'h2Label' => 'Crear Profesor',
            'academiasSeleccionadas' => $data['academias'] ?? [],
            'academias' => $academias,
            'menu' => $menu,
            'metaUrlForm' => route('profesores.create'),
            'data' => $data,
        ];
    }
}
З Paso 2: Usar el Trait en el Controller
php
Copiar
Editar
use App\Traits\PreparaFormularioProfesor;

class ProfesorController extends Controller
{
    use PreparaFormularioProfesor;

    public function create(): View
    {
        $vars = $this->prepararFormularioProfesor();

        return view('profesores.partials.form', $vars);
    }
}
З Paso 3: Usar el Trait en ProfesorRequest
php
Copiar
Editar
use App\Traits\PreparaFormularioProfesor;
use Illuminate\Contracts\Validation\Validator;
use Illuminate\Http\Exceptions\HttpResponseException;
use Illuminate\Support\ViewErrorBag;

class ProfesorRequest extends FormRequest
{
    use PreparaFormularioProfesor;

    public function failedValidation(Validator $validator)
    {
        $viewErrors = new ViewErrorBag();
        $viewErrors->put('default', $validator->errors());

        $formVars = $this->prepararFormularioProfesor($this->all());

        $view = view('profesores.partials.form', array_merge(
            $formVars,
            ['errors' => $viewErrors]
        ))->render();

        throw new HttpResponseException(
            response($view, 422)
        );
    }
}

//TODO
-Setear la academia en la que estamos cuando entramos en ella--> LISTO
-Configurar la edici贸n de la academia cuando estamos en el panel principal(sidebar) -->LISTO
-Filtrar a los alumnos de los clientes linkados por academia seleccionada -->LISTO
-Creaci贸n del modelo grupos (ESTAMOS EN ELLO)--> AADIR ALUMNOS/ PROFESORES / ASIGNATURAS
-FILTRAR COMBO ACADEMIAS DE LOS ELEMENTOS CON EL VALOR SELECCIONADO en SESSION
-Generar calendario
-Eliminar en el listado gen茅rico de clientes los duplicaod de academias
-DATOS FISCALES DE ACADEMIAS



-Restauraci贸n de password --> LISTO, Faltan detalles de implementaci贸n como mensajes en los distintos steps donde se solicita
-Asistencia alumnos
-Comunicaciones
    generaremos una nueva pesta帽a de comunicaciones desde donde podremos gestionar la comunicaci贸n de nuestra herramienta
    con los usuarios potenciales(profesore, alumnos, clientes, usuarios)

    Dentro de comunicaciones haremos apartado
        -plantillas email
        -emails enviados-->filtros
        -programar env铆o
        -env铆o de email

            idplantilla
            nombre
            created

            Secciones:
                100%
                2 columns
                3 columns
                4 columns
            
                insert("ecb_emails_rows",array(
                "idrow"=>intval($maxid[0]["idrow"]+1),
                "idtyperow"=>intval($_REQUEST["idtyperow"]),
                "properties"=>json_encode($properties),
                "sort"=>intval($_REQUEST["position"]),
                "idemail"=>intval($_REQUEST["idemail"])


            Content:
                Header
                Image
                Title
                Paragraph
                Button
                Divider
                List
                Html
                Footer

                $resul=$db->insert("ecb_emails_blocks",array(
                        "idblock"=>intval($maxid[0]["idblock"]+1),
                        "idtypeblock"=>intval($_REQUEST["idtypeblock"]),
                        "idrow"=>intval($_REQUEST["idrow"]),
                        "col"=>intval($_REQUEST["col"]),
                        "properties"=>json_encode($properties),
                        "sort"=>intval($_REQUEST["position"]),
                        "idemail"=>intval($_REQUEST["idemail"]),
                    ));

            Concepto de col, que hace referencia en que col se inserta


    Plantillas de email:
        tendremos un listado donde podremos gestionar las plantillas de email 
            las plantillas de email nos basaremos en la herramienta emailbuilder. 

    Emails enviados->mostraremos el listado de emails que hemos enviado(y ver si se ha leido), podremos entrar en el detalle              
        para ver a que usuarios se ha enviado
    
    Programar env铆o:
        Seleccionaremos una plantilla o un texto que enviaremos con la fecha programada(control de fechas, solo lo podremos enviar una vez)
        No dejaremos enviar m谩s de 15 veces un correo.







